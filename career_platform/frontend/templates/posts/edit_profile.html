{% extends 'base.html' %}
{% load static %}

{% block title %}Edit Profile - BPUT Career Platform{% endblock %}

{% block content %}
<div class="container-fluid py-4" style="
    background: 
        radial-gradient(circle at 10% 20%, rgba(255, 215, 0, 0.15) 0%, transparent 20%),
        radial-gradient(circle at 90% 80%, rgba(19, 136, 8, 0.15) 0%, transparent 20%),
        radial-gradient(circle at 50% 50%, rgba(255, 105, 180, 0.1) 0%, transparent 30%),
        radial-gradient(circle at 30% 70%, rgba(0, 71, 171, 0.15) 0%, transparent 25%),
        linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
    min-height: 100vh;
    position: relative;
    overflow: hidden;
">

<!-- Lotus Flower Decorations -->
<div style="position: absolute; top: 10%; left: 5%; opacity: 0.08; transform: rotate(-15deg);">
    <i class="fas fa-spa" style="font-size: 80px; color: #FF69B4;"></i>
</div>
<div style="position: absolute; top: 15%; right: 8%; opacity: 0.08; transform: rotate(25deg);">
    <i class="fas fa-spa" style="font-size: 60px; color: #FF9933;"></i>
</div>
<div style="position: absolute; bottom: 20%; left: 8%; opacity: 0.08; transform: rotate(45deg);">
    <i class="fas fa-spa" style="font-size: 70px; color: #138808;"></i>
</div>
<div style="position: absolute; bottom: 15%; right: 5%; opacity: 0.08; transform: rotate(-30deg);">
    <i class="fas fa-spa" style="font-size: 90px; color: #0047AB;"></i>
</div>

<!-- Peacock Feather Decorations -->
<div style="position: absolute; top: 5%; right: 15%; opacity: 0.06;">
    <i class="fas fa-feather-alt" style="font-size: 50px; color: #0047AB;"></i>
</div>
<div style="position: absolute; bottom: 10%; left: 15%; opacity: 0.06; transform: rotate(180deg);">
    <i class="fas fa-feather-alt" style="font-size: 40px; color: #138808;"></i>
</div>

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card shadow border-0" style="
                    border-radius: 20px; 
                    border: 2px solid rgba(255, 255, 255, 0.2);
                    background: linear-gradient(135deg, 
                        rgba(255, 255, 255, 0.98) 0%, 
                        rgba(248, 249, 250, 0.98) 100%);
                    backdrop-filter: blur(20px);
                    position: relative;
                    overflow: hidden;
                    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
                ">
                <div style="
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    height: 6px;
                    background: linear-gradient(90deg, 
                        #FF9933, 
                        #FF69B4, 
                        #138808, 
                        #0047AB);
                "></div>
                    <!-- Header -->
                    <div class="card-body p-5">
                        <div class="text-center mb-5">
                            <h1 class="mb-3" style="
                                color: #2D3748; 
                                font-weight: 800;
                                font-size: 2.5rem;
                                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
                                background: linear-gradient(135deg, #FF9933, #138808);
                                -webkit-background-clip: text;
                                -webkit-text-fill-color: transparent;
                                background-clip: text;
                            ">
                                <i class="fas fa-user-edit me-3"></i>Edit Your Profile
                            </h1>
                            <p class="mb-0" style="
                                color: #4A5568; 
                                font-size: 1.2rem;
                                font-weight: 500;
                                text-shadow: 0 1px 2px rgba(255,255,255,0.8);
                            ">
                                Update your profile photo and personal information
                            </p>
                        </div>

                        <!-- Current Profile Preview -->
                        <div class="text-center mb-5 p-4" style="
                            background: linear-gradient(135deg, rgba(255, 153, 51, 0.1), rgba(19, 136, 8, 0.1));
                            border-radius: 20px;
                            border: 2px solid rgba(255, 153, 51, 0.3);
                        ">
                            <img id="profilePreview" 
                                 src="{% if has_profile_photo %}{{ user_profile.profile_photo.url }}{% else %}{% static 'images/default-avatar.png' %}{% endif %}" 
                                 class="rounded-circle mb-3 shadow" 
                                 style="
                                    width: 160px; 
                                    height: 160px; 
                                    object-fit: cover; 
                                    border: 5px solid #FF9933;
                                    box-shadow: 0 8px 25px rgba(255, 153, 51, 0.4);
                                 "
                                 alt="Current Profile Photo">
                            <h4 style="
                                color: #2D3748; 
                                font-weight: 700;
                                margin-bottom: 0.5rem;
                                text-shadow: 0 1px 2px rgba(0,0,0,0.1);
                            ">{{ user.username }}</h4>
                            <p class="mb-0" style="
                                color: #718096; 
                                font-weight: 500;
                                font-size: 1rem;
                            ">Your profile appears on all your posts and activities</p>
                        </div>

                        <!-- Edit Form -->
                        <form method="POST" enctype="multipart/form-data">
                            {% csrf_token %}
                            
                            <div class="row">
                                <!-- Profile Photo -->
                                <div class="col-md-6 mb-4">
                                    <label class="form-label fw-bold" style="
                                        color: #2D3748; 
                                        font-size: 1.1rem;
                                        margin-bottom: 0.8rem;
                                        display: block;
                                        text-shadow: 0 1px 2px rgba(0,0,0,0.1);
                                    ">
                                        <i class="fas fa-camera me-2" style="color: #FF9933;"></i>Profile Photo
                                    </label>
                                    <input type="file" name="profile_photo" class="form-control" id="id_profile_photo" accept="image/*" style="
                                        border-radius: 12px; 
                                        border: 2px solid #E2E8F0;
                                        padding: 12px 16px;
                                        font-size: 1rem;
                                        background: white;
                                        transition: all 0.3s ease;
                                        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                                    ">
                                    <div class="form-text mt-2" style="
                                        color: #718096; 
                                        font-size: 0.9rem;
                                        font-weight: 500;
                                    ">
                                        üì∏ Upload a clear photo of yourself. Maximum 5MB file size.
                                    </div>
                                </div>

                                <!-- User Role -->
                                <div class="col-md-6 mb-4">
                                    <label class="form-label fw-bold" style="
                                        color: #2D3748; 
                                        font-size: 1.1rem;
                                        margin-bottom: 0.8rem;
                                        display: block;
                                        text-shadow: 0 1px 2px rgba(0,0,0,0.1);
                                    ">
                                        <i class="fas fa-user-tag me-2" style="color: #138808;"></i>Your Role
                                    </label>
                                    <select name="role" class="form-select" id="id_role" style="
                                        border-radius: 12px; 
                                        border: 2px solid #E2E8F0;
                                        padding: 12px 16px;
                                        font-size: 1rem;
                                        background: white;
                                        transition: all 0.3s ease;
                                        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                                    ">
                                        <option value="student" {% if user_profile.role == 'student' %}selected{% endif %}>üéì Student</option>
                                        <option value="company" {% if user_profile.role == 'company' %}selected{% endif %}>üè¢ Company</option>
                                        <option value="university" {% if user_profile.role == 'university' %}selected{% endif %}>üèõÔ∏è University</option>
                                    </select>
                                    <div class="form-text mt-2" style="
                                        color: #718096; 
                                        font-size: 0.9rem;
                                        font-weight: 500;
                                    ">
                                        üé≠ This determines how your posts are displayed to others
                                    </div>
                                </div>
                            </div>

                            <!-- Bio -->
                            <div class="mb-4">
                                <label class="form-label fw-bold" style="
                                    color: #2D3748; 
                                    font-size: 1.1rem;
                                    margin-bottom: 0.8rem;
                                    display: block;
                                    text-shadow: 0 1px 2px rgba(0,0,0,0.1);
                                ">
                                    <i class="fas fa-edit me-2" style="color: #0047AB;"></i>About You
                                </label>
                                <textarea name="bio" class="form-control" id="id_bio" rows="5" placeholder="Tell everyone about yourself, your interests, career goals, and achievements... ‚ú®" style="
                                    border-radius: 12px; 
                                    border: 2px solid #E2E8F0; 
                                    padding: 16px; 
                                    resize: vertical;
                                    font-size: 1rem;
                                    background: white;
                                    transition: all 0.3s ease;
                                    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                                    line-height: 1.6;
                                ">{{ user_profile.bio }}</textarea>
                                <div class="form-text mt-2" style="
                                    color: #718096; 
                                    font-size: 0.9rem;
                                    font-weight: 500;
                                ">
                                    üìù Share your story, interests, and career aspirations with the community
                                </div>
                            </div>

                            <!-- Messages -->
                            {% if messages %}
                            <div class="mb-4">
                                {% for message in messages %}
                                <div class="alert alert-{% if message.tags == 'error' %}danger{% else %}{{ message.tags }}{% endif %} alert-dismissible fade show shadow-sm" style="
                                    border-radius: 12px;
                                    border: none;
                                    font-weight: 500;
                                ">
                                    <div class="d-flex align-items-center">
                                        <i class="fas 
                                            {% if message.tags == 'success' %}fa-check-circle text-success
                                            {% elif message.tags == 'error' %}fa-exclamation-circle text-danger
                                            {% elif message.tags == 'warning' %}fa-exclamation-triangle text-warning
                                            {% else %}fa-info-circle text-info{% endif %}
                                        me-2 fa-lg"></i>
                                        <span style="font-size: 1rem;">{{ message }}</span>
                                    </div>
                                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                                </div>
                                {% endfor %}
                            </div>
                            {% endif %}

                            <!-- Form Errors -->
                            {% if form.errors %}
                            <div class="alert alert-danger shadow-sm" style="
                                border-radius: 12px;
                                border: none;
                                background: linear-gradient(135deg, #fed7d7, #feb2b2);
                            ">
                                <strong style="color: #9B2C2C;">Please correct the following errors:</strong>
                                <ul class="mb-0 mt-2">
                                    {% for field, errors in form.errors.items %}
                                        {% for error in errors %}
                                            <li style="color: #9B2C2C; font-weight: 500;">{{ field|title }}: {{ error }}</li>
                                        {% endfor %}
                                    {% endfor %}
                                </ul>
                            </div>
                            {% endif %}

                            <!-- Action Buttons -->
                            <div class="d-flex justify-content-between mt-5 pt-4" style="border-top: 2px solid #E2E8F0;">
                                <a href="{% url 'posts_feed' %}" class="btn py-3 px-5" style="
                                    background: transparent; 
                                    border: 3px solid #718096; 
                                    color: #718096; 
                                    border-radius: 12px; 
                                    font-weight: 700;
                                    font-size: 1.1rem;
                                    transition: all 0.3s ease;
                                    text-shadow: 0 1px 2px rgba(0,0,0,0.1);
                                ">
                                    <i class="fas fa-arrow-left me-2"></i>Back to Feed
                                </a>
                                <button type="submit" class="btn py-3 px-5" style="
                                    background: linear-gradient(135deg, #FF9933, #138808); 
                                    color: white; 
                                    border: none; 
                                    border-radius: 12px; 
                                    font-weight: 700;
                                    font-size: 1.1rem;
                                    transition: all 0.3s ease;
                                    box-shadow: 0 4px 15px rgba(255, 153, 51, 0.4);
                                    text-shadow: 0 1px 2px rgba(0,0,0,0.2);
                                ">
                                    <i class="fas fa-save me-2"></i>Update Profile
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Preview profile photo before upload
document.getElementById('id_profile_photo').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('profilePreview').src = e.target.result;
        }
        reader.readAsDataURL(file);
    }
});

// Enhanced form styling with hover effects
document.addEventListener('DOMContentLoaded', function() {
    console.log('üé® Edit Profile Page with Enhanced Text Visibility Loaded');
    
    // Add focus and hover effects to form elements
    const formElements = document.querySelectorAll('#id_profile_photo, #id_role, #id_bio');
    
    formElements.forEach(element => {
        // Focus effects
        element.addEventListener('focus', function() {
            this.style.borderColor = '#FF9933';
            this.style.boxShadow = '0 0 0 3px rgba(255, 153, 51, 0.2), 0 4px 12px rgba(0,0,0,0.15)';
            this.style.transform = 'translateY(-2px)';
        });
        
        element.addEventListener('blur', function() {
            this.style.borderColor = '#E2E8F0';
            this.style.boxShadow = '0 2px 8px rgba(0,0,0,0.1)';
            this.style.transform = 'translateY(0)';
        });
        
        // Hover effects
        element.addEventListener('mouseenter', function() {
            if (document.activeElement !== this) {
                this.style.borderColor = '#CBD5E0';
                this.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
            }
        });
        
        element.addEventListener('mouseleave', function() {
            if (document.activeElement !== this) {
                this.style.borderColor = '#E2E8F0';
                this.style.boxShadow = '0 2px 8px rgba(0,0,0,0.1)';
            }
        });
    });
    
    // Button hover effects
    const submitBtn = document.querySelector('button[type="submit"]');
    const cancelBtn = document.querySelector('a.btn');
    
    [submitBtn, cancelBtn].forEach(btn => {
        if (btn) {
            btn.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-3px)';
                this.style.boxShadow = '0 8px 25px rgba(255, 153, 51, 0.5)';
            });
            
            btn.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
                if (this === submitBtn) {
                    this.style.boxShadow = '0 4px 15px rgba(255, 153, 51, 0.4)';
                } else {
                    this.style.boxShadow = 'none';
                }
            });
        }
    });
});
</script>
{% endblock %}