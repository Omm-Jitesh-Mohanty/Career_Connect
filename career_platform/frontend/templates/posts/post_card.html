<div class="peacock-theme-card p-4 mb-4 post-card" id="post-{{ post.id }}">
    <!-- Post Header -->
    <div class="d-flex justify-content-between align-items-start mb-3">
        <div class="d-flex align-items-center">
            <div class="profile-avatar me-3">
                {% if post.user.userprofile.profile_photo %}
                    <img src="{{ post.user.userprofile.profile_photo.url }}" class="profile-avatar-img" alt="{{ post.user.username }}">
                {% else %}
                    <div class="default-avatar">
                        <i class="fas fa-user-circle fa-2x text-odisha"></i>
                    </div>
                {% endif %}
            </div>
            <div>
                <h6 class="mb-0 fw-bold">{{ post.user.username }}</h6>
                <div class="d-flex align-items-center">
                    <span class="role-badge me-2">{{ post.user.userprofile.get_role_display|default:"Student" }}</span>
                    <small class="text-muted">{{ post.created_at|timesince }} ago</small>
                </div>
            </div>
        </div>
        
        {% if post.user == user %}
        <div class="dropdown">
            <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                <i class="fas fa-ellipsis-h"></i>
            </button>
            <ul class="dropdown-menu">
                <li>
                    <form method="POST" action="{% url 'delete_post' post.id %}" class="d-inline">
                        {% csrf_token %}
                        <button type="submit" class="dropdown-item text-danger" onclick="return confirm('Are you sure you want to delete this post?')">
                            <i class="fas fa-trash me-2"></i>Delete Post
                        </button>
                    </form>
                </li>
            </ul>
        </div>
        {% endif %}
    </div>

    <!-- Post Content -->
    <div class="post-content mb-3">
        <p class="mb-3" style="line-height: 1.6; font-size: 1rem;">{{ post.content|linebreaksbr }}</p>
        
        {% if post.image %}
        <div class="post-image mb-3 text-center">
            <img src="{{ post.image.url }}" alt="Post image" class="img-fluid rounded" style="max-height: 400px; width: auto; border: 2px solid #e9ecef;">
        </div>
        {% endif %}
        
        {% if post.video %}
        <div class="post-video mb-3 text-center">
            <video controls class="img-fluid rounded" style="max-height: 400px; width: auto; border: 2px solid #e9ecef;">
                <source src="{{ post.video.url }}" type="video/mp4">
                Your browser does not support the video tag.
            </video>
        </div>
        {% endif %}
    </div>

    <!-- Post Stats -->
    <div class="d-flex justify-content-between text-muted mb-3 small">
        <span>
            <i class="fas fa-heart text-danger me-1"></i>
            <span class="like-count">{{ post.like_set.count }}</span> likes
        </span>
        <span>
            <i class="fas fa-comment me-1"></i>
            {{ post.comment_set.count }} comments
        </span>
    </div>

    <!-- Action Buttons -->
    <div class="d-flex justify-content-around border-top border-bottom py-2 mb-3">
        <button class="like-btn btn btn-sm {% if user in post.like_set.all %}liked{% else %}text-muted{% endif %}" 
                onclick="toggleLike('{{ post.id }}', this)">
            <i class="{% if user in post.like_set.all %}fas{% else %}far{% endif %} fa-heart me-1"></i>
            <span>Like</span>
        </button>
        
        <button class="btn btn-sm text-muted" type="button" data-bs-toggle="collapse" 
                data-bs-target="#comments-{{ post.id }}">
            <i class="fas fa-comment me-1"></i>
            Comment
        </button>
        
        <button class="btn btn-sm text-muted" onclick="sharePost('{{ post.id }}')">
            <i class="fas fa-share me-1"></i>
            Share
        </button>
    </div>

    <!-- Comments Section -->
    <div class="collapse comment-section" id="comments-{{ post.id }}">
        <div class="comments-list mb-3">
            {% for comment in post.comment_set.all %}
            <div class="d-flex mb-3">
                <div class="profile-avatar me-2" style="width: 35px; height: 35px;">
                    {% if comment.user.userprofile.profile_photo %}
                        <img src="{{ comment.user.userprofile.profile_photo.url }}" class="profile-avatar-img" alt="{{ comment.user.username }}">
                    {% else %}
                        <div class="default-avatar">
                            <i class="fas fa-user-circle text-odisha"></i>
                        </div>
                    {% endif %}
                </div>
                <div class="flex-grow-1">
                    <div class="bg-light rounded p-3">
                        <strong class="d-block mb-1">{{ comment.user.username }}</strong>
                        <p class="mb-2" style="font-size: 0.9rem;">{{ comment.content }}</p>
                        <small class="text-muted">{{ comment.created_at|timesince }} ago</small>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="text-center text-muted py-3">
                <i class="fas fa-comments me-1"></i>
                No comments yet. Be the first to comment!
            </div>
            {% endfor %}
        </div>
        
        <!-- Add Comment Form -->
        <form class="add-comment-form" onsubmit="addComment('{{ post.id }}', this); return false;">
            {% csrf_token %}
            <div class="input-group">
                <input type="text" name="content" class="form-control festival-comment-input" 
                       placeholder="Write a comment..." required style="border-radius: 20px 0 0 20px;">
                <button class="btn festival-btn" type="submit" style="border-radius: 0 20px 20px 0;">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </form>
    </div>
</div>

<style>
.profile-avatar-img {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    object-fit: cover;
}

.default-avatar {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #f8f9fa;
    border-radius: 50%;
    border: 2px solid #e9ecef;
}

.post-image img,
.post-video video {
    max-width: 100%;
    border-radius: 10px;
}
</style>

<script>
function sharePost(postId) {
    // Simple share functionality
    const postUrl = window.location.href;
    if (navigator.share) {
        navigator.share({
            title: 'BPUT Community Post',
            text: 'Check out this post from BPUT Community',
            url: postUrl,
        })
        .then(() => console.log('Successful share'))
        .catch((error) => console.log('Error sharing:', error));
    } else {
        // Fallback: copy to clipboard
        navigator.clipboard.writeText(postUrl).then(() => {
            alert('Post link copied to clipboard!');
        });
    }
}
</script>