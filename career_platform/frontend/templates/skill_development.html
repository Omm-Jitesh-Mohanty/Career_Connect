<!-- frontend/templates/skill_development.html -->
{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container py-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="cultural-card p-4">
                <h2 class="text-center mb-3">Skill Development</h2>
                <p class="text-center text-muted mb-0">
                    Personalized learning paths and courses to enhance your career skills
                </p>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Learning Paths -->
        <div class="col-lg-8">
            <div class="cultural-card p-4 mb-4">
                <h4 class="mb-4">
                    <i class="fas fa-road me-2 text-primary"></i>
                    Learning Paths
                </h4>
                
                <div id="learningPathsContainer" class="row">
                    <!-- Learning paths will be loaded here -->
                    <div class="col-12 text-center py-4">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-3 text-muted">Loading learning paths...</p>
                    </div>
                </div>
            </div>

            <!-- Recommended Courses -->
            <div class="cultural-card p-4">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4 class="mb-0">
                        <i class="fas fa-graduation-cap me-2 text-success"></i>
                        Recommended Courses
                    </h4>
                    <div class="btn-group btn-group-sm">
                        <button class="btn btn-outline-primary active" data-filter="all">All</button>
                        <button class="btn btn-outline-primary" data-filter="free">Free</button>
                        <button class="btn btn-outline-primary" data-filter="paid">Paid</button>
                    </div>
                </div>
                
                <div id="coursesContainer" class="row">
                    <!-- Courses will be loaded here -->
                    <div class="col-12 text-center py-4">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-3 text-muted">Loading recommended courses...</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Skill Analysis & Quick Actions -->
        <div class="col-lg-4">
            <!-- Skill Gaps -->
            <div class="cultural-card p-4 mb-4">
                <h5 class="mb-3">
                    <i class="fas fa-chart-line me-2 text-warning"></i>
                    Your Skill Gaps
                </h5>
                
                <div id="skillGapsContainer">
                    <!-- Skill gaps will be loaded here -->
                    <div class="text-center py-3">
                        <div class="spinner-border spinner-border-sm text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-2 small text-muted">Analyzing your skills...</p>
                    </div>
                </div>
            </div>
            
            <!-- Platform Stats -->
            <div class="cultural-card p-4 mb-4">
                <h5 class="mb-3">
                    <i class="fas fa-layer-group me-2 text-info"></i>
                    Learning Platforms
                </h5>
                
                <div class="platform-stats">
                    <div class="platform-item d-flex justify-content-between align-items-center mb-2 p-2 border rounded">
                        <div>
                            <i class="fas fa-university me-2 text-primary"></i>
                            <span>Coursera</span>
                        </div>
                        <span class="badge bg-primary">Premium</span>
                    </div>
                    
                    <div class="platform-item d-flex justify-content-between align-items-center mb-2 p-2 border rounded">
                        <div>
                            <i class="fas fa-graduation-cap me-2 text-success"></i>
                            <span>NPTEL</span>
                        </div>
                        <span class="badge bg-success">Free</span>
                    </div>
                    
                    <div class="platform-item d-flex justify-content-between align-items-center mb-2 p-2 border rounded">
                        <div>
                            <i class="fas fa-code me-2 text-warning"></i>
                            <span>GeeksForGeeks</span>
                        </div>
                        <span class="badge bg-warning">Mixed</span>
                    </div>
                    
                    <div class="platform-item d-flex justify-content-between align-items-center p-2 border rounded">
                        <div>
                            <i class="fas fa-laptop-code me-2 text-danger"></i>
                            <span>FreeCodeCamp</span>
                        </div>
                        <span class="badge bg-success">Free</span>
                    </div>
                </div>
            </div>
            
            <!-- Quick Progress -->
            <div class="cultural-card p-4">
                <h5 class="mb-3">
                    <i class="fas fa-trophy me-2 text-warning"></i>
                    Learning Progress
                </h5>
                
                <div class="progress-stats">
                    <div class="progress-item mb-3">
                        <div class="d-flex justify-content-between mb-1">
                            <small class="text-muted">Python Mastery</small>
                            <small class="text-muted">65%</small>
                        </div>
                        <div class="progress" style="height: 6px;">
                            <div class="progress-bar bg-success" style="width: 65%"></div>
                        </div>
                    </div>
                    
                    <div class="progress-item mb-3">
                        <div class="d-flex justify-content-between mb-1">
                            <small class="text-muted">Web Development</small>
                            <small class="text-muted">40%</small>
                        </div>
                        <div class="progress" style="height: 6px;">
                            <div class="progress-bar bg-info" style="width: 40%"></div>
                        </div>
                    </div>
                    
                    <div class="progress-item">
                        <div class="d-flex justify-content-between mb-1">
                            <small class="text-muted">Data Science</small>
                            <small class="text-muted">25%</small>
                        </div>
                        <div class="progress" style="height: 6px;">
                            <div class="progress-bar bg-warning" style="width: 25%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.learning-path-card {
    transition: all 0.3s ease;
    border-left: 4px solid #007bff;
}

.learning-path-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.course-card {
    transition: all 0.3s ease;
    border: 1px solid #e0e0e0;
}

.course-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.skill-gap-item {
    border-left: 3px solid #ffc107;
    background: #fff9e6;
}

.free-badge {
    background-color: #198754;
}

.rating-stars {
    color: #ffc107;
}

.platform-item {
    transition: background-color 0.2s ease;
}

.platform-item:hover {
    background-color: #f8f9fa;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    loadSkillDevelopmentData();
    
    // Course filter buttons
    document.querySelectorAll('[data-filter]').forEach(button => {
        button.addEventListener('click', function() {
            // Remove active class from all buttons
            document.querySelectorAll('[data-filter]').forEach(btn => {
                btn.classList.remove('active');
            });
            // Add active class to clicked button
            this.classList.add('active');
            
            filterCourses(this.dataset.filter);
        });
    });
});

async function loadSkillDevelopmentData() {
    try {
        const response = await fetch('/ai-engine/skill-development/');
        const data = await response.json();
        
        if (data.success) {
            displayLearningPaths(data.learning_paths);
            displayCourses(data.recommended_courses);
            displaySkillGaps(data.skill_analysis.skill_gaps);
        } else {
            showNotification('Failed to load skill development data: ' + data.error, 'error');
        }
    } catch (error) {
        console.error('Error loading skill development data:', error);
        showNotification('Error loading learning resources. Please try again.', 'error');
    }
}

function displayLearningPaths(learningPaths) {
    const container = document.getElementById('learningPathsContainer');
    
    if (!learningPaths || learningPaths.length === 0) {
        container.innerHTML = `
            <div class="col-12 text-center py-4">
                <i class="fas fa-road fa-3x text-muted mb-3"></i>
                <h5>No learning paths available</h5>
                <p class="text-muted">Complete your profile to get personalized learning paths.</p>
            </div>
        `;
        return;
    }
    
    let pathsHTML = '';
    
    learningPaths.forEach(path => {
        pathsHTML += `
            <div class="col-12 mb-4">
                <div class="card learning-path-card">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-8">
                                <h5 class="card-title">${path.title}</h5>
                                <p class="card-text text-muted">${path.description}</p>
                                
                                <div class="mb-3">
                                    <small class="text-muted">Skills you'll learn:</small>
                                    <div class="mt-1">
                                        ${path.skills.map(skill => 
                                            `<span class="badge bg-light text-dark me-1 mb-1">${skill}</span>`
                                        ).join('')}
                                    </div>
                                </div>
                                
                                <div class="path-details">
                                    <span class="badge bg-primary me-2">
                                        <i class="fas fa-clock me-1"></i>${path.duration}
                                    </span>
                                    <span class="badge bg-secondary">
                                        <i class="fas fa-signal me-1"></i>${path.level}
                                    </span>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="career-opportunities">
                                    <h6>Career Opportunities:</h6>
                                    <ul class="list-unstyled">
                                        ${path.career_opportunities.slice(0, 3).map(opportunity => 
                                            `<li class="small"><i class="fas fa-arrow-right me-1 text-success"></i>${opportunity}</li>`
                                        ).join('')}
                                    </ul>
                                </div>
                                
                                <div class="d-grid gap-2 mt-3">
                                    ${path.courses.map(course => 
                                        `<a href="${course.url}" target="_blank" class="btn btn-outline-primary btn-sm">
                                            ${course.platform} Course
                                        </a>`
                                    ).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    });
    
    container.innerHTML = pathsHTML;
}

function displayCourses(courses) {
    const container = document.getElementById('coursesContainer');
    
    if (!courses || courses.length === 0) {
        container.innerHTML = `
            <div class="col-12 text-center py-4">
                <i class="fas fa-graduation-cap fa-3x text-muted mb-3"></i>
                <h5>No courses available</h5>
                <p class="text-muted">Check back later for new course recommendations.</p>
            </div>
        `;
        return;
    }
    
    let coursesHTML = '';
    
    courses.forEach(course => {
        coursesHTML += `
            <div class="col-md-6 mb-4 course-item" data-type="${course.is_free ? 'free' : 'paid'}">
                <div class="card h-100 course-card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h6 class="card-title mb-0">${course.title}</h6>
                            <span class="badge ${course.is_free ? 'free-badge' : 'bg-primary'}">
                                ${course.is_free ? 'Free' : 'Paid'}
                            </span>
                        </div>
                        
                        <p class="card-subtitle mb-2 text-muted small">${course.provider}</p>
                        
                        <div class="course-details mb-3">
                            <p class="small mb-1">
                                <i class="fas fa-clock me-1 text-muted"></i>
                                ${course.duration}
                            </p>
                            <p class="small mb-1">
                                <i class="fas fa-signal me-1 text-muted"></i>
                                ${course.level}
                            </p>
                            <p class="small mb-2">
                                <i class="fas fa-star me-1 text-warning"></i>
                                ${course.rating}/5.0
                            </p>
                        </div>
                        
                        <div class="skills-section">
                            <small class="text-muted">Skills covered:</small>
                            <p class="small">${course.skills_covered}</p>
                        </div>
                    </div>
                    
                    <div class="card-footer bg-transparent">
                        <div class="d-grid gap-2">
                            <a href="${course.url}" target="_blank" class="btn btn-primary btn-sm">
                                <i class="fas fa-external-link-alt me-1"></i>Enroll Now
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        `;
    });
    
    container.innerHTML = coursesHTML;
}

function displaySkillGaps(skillGaps) {
    const container = document.getElementById('skillGapsContainer');
    
    if (!skillGaps || skillGaps.length === 0) {
        container.innerHTML = `
            <div class="text-center py-3">
                <i class="fas fa-check-circle fa-2x text-success mb-2"></i>
                <p class="text-muted mb-0">No major skill gaps identified!</p>
                <small class="text-muted">Your skills are well-aligned with market demands.</small>
            </div>
        `;
        return;
    }
    
    let gapsHTML = '';
    
    skillGaps.forEach(gap => {
        gapsHTML += `
            <div class="skill-gap-item mb-3 p-3 border rounded">
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <h6 class="mb-0">${gap.skill}</h6>
                    <span class="badge bg-${gap.priority === 'High' ? 'danger' : 'warning'}">
                        ${gap.priority} Priority
                    </span>
                </div>
                <p class="small text-muted mb-2">${gap.market_demand}</p>
                <p class="small mb-2">
                    <i class="fas fa-clock me-1"></i>
                    <strong>Duration:</strong> ${gap.duration}
                </p>
                <div class="resources">
                    <small class="text-muted">Learning Path:</small>
                    <ul class="list-unstyled mt-1 small">
                        ${gap.learning_path.map(step => 
                            `<li><i class="fas fa-arrow-right me-1 text-primary"></i>${step}</li>`
                        ).join('')}
                    </ul>
                </div>
            </div>
        `;
    });
    
    container.innerHTML = gapsHTML;
}

function filterCourses(filterType) {
    const courseItems = document.querySelectorAll('.course-item');
    
    courseItems.forEach(item => {
        if (filterType === 'all') {
            item.style.display = 'block';
        } else {
            const courseType = item.dataset.type;
            if (courseType === filterType) {
                item.style.display = 'block';
            } else {
                item.style.display = 'none';
            }
        }
    });
}

function showNotification(message, type = 'info') {
    // Create toast container if it doesn't exist
    let toastContainer = document.getElementById('toastContainer');
    if (!toastContainer) {
        toastContainer = document.createElement('div');
        toastContainer.id = 'toastContainer';
        toastContainer.className = 'toast-container position-fixed top-0 end-0 p-3';
        document.body.appendChild(toastContainer);
    }
    
    const toastHtml = `
        <div class="toast align-items-center text-bg-${type === 'success' ? 'success' : 'danger'} border-0" role="alert">
            <div class="d-flex">
                <div class="toast-body">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-triangle'} me-2"></i>
                    ${message}
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
            </div>
        </div>
    `;
    
    toastContainer.insertAdjacentHTML('beforeend', toastHtml);
    
    const toastElement = toastContainer.lastElementChild;
    const toast = new bootstrap.Toast(toastElement);
    toast.show();
    
    toastElement.addEventListener('hidden.bs.toast', function() {
        this.remove();
    });
}
</script>
{% endblock %}