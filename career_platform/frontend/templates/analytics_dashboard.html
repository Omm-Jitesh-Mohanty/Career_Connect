<!-- templates/analytics_dashboard.html -->
{% extends 'base.html' %}
{% load static %}

{% block title %}AI Career Analytics Dashboard - BPUT{% endblock %}

{% block extra_css %}
<style>
    .chart-container {
        position: relative;
        height: 300px;
        width: 100%;
        min-height: 300px;
    }
    .metric-card {
        text-align: center;
        padding: 15px;
        background: linear-gradient(135deg, #FF9933, #138808);
        color: white;
        border-radius: 10px;
        margin-bottom: 15px;
        transition: transform 0.3s ease;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .metric-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }
    .metric-value {
        font-size: 1.8rem;
        font-weight: bold;
        margin: 5px 0;
    }
    .chart-clickable {
        cursor: pointer;
    }
    .profile-strength {
        text-align: center;
        padding: 20px;
    }
    .strength-score {
        font-size: 2.5rem;
        font-weight: bold;
        color: #138808;
        margin: 10px 0;
    }
    .insight-card {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        border-left: 4px solid #138808;
        margin-bottom: 10px;
        transition: all 0.3s ease;
    }
    .insight-card:hover {
        transform: translateX(5px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .cultural-card {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        border: 1px solid #e0e0e0;
        margin-bottom: 20px;
        height: 100%;
        transition: all 0.3s ease;
    }
    .cultural-card:hover {
        box-shadow: 0 8px 15px rgba(0,0,0,0.15);
    }
    .progress {
        background-color: #e9ecef;
        height: 12px;
        border-radius: 10px;
    }
    .progress-bar {
        background-color: #138808;
        border-radius: 10px;
    }
    
    /* Chart specific fixes */
    canvas {
        display: block;
        width: 100% !important;
        height: 100% !important;
    }
    
    /* Responsive improvements */
    @media (max-width: 768px) {
        .chart-container {
            height: 250px;
        }
        .cultural-card {
            padding: 15px;
        }
        .metric-value {
            font-size: 1.5rem;
        }
    }
</style>
{% endblock %}

{% block extra_scripts %}
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <!-- Dashboard Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="cultural-card">
                <h2><i class="fas fa-chart-line"></i> Interactive Career Analytics Dashboard</h2>
                <p class="text-muted">Click on any chart element to explore relevant opportunities and courses</p>
                
                <!-- Quick Metrics -->
                <div class="row mt-3">
                    <div class="col-md-2 col-6">
                        <div class="metric-card">
                            <div class="metric-value">{{ dashboard_metrics.profile_completeness }}%</div>
                            <small>Profile Complete</small>
                        </div>
                    </div>
                    <div class="col-md-2 col-6">
                        <div class="metric-card">
                            <div class="metric-value">{{ dashboard_metrics.skills_count }}</div>
                            <small>Skills</small>
                        </div>
                    </div>
                    <div class="col-md-2 col-6">
                        <div class="metric-card">
                            <div class="metric-value">{{ dashboard_metrics.recommendations_count }}</div>
                            <small>Job Matches</small>
                        </div>
                    </div>
                    <div class="col-md-2 col-6">
                        <div class="metric-card">
                            <div class="metric-value">{{ dashboard_metrics.internships_matched }}</div>
                            <small>Internships</small>
                        </div>
                    </div>
                    <div class="col-md-2 col-6">
                        <div class="metric-card">
                            <div class="metric-value">{{ dashboard_metrics.skill_gaps_identified }}</div>
                            <small>Skill Gaps</small>
                        </div>
                    </div>
                    <div class="col-md-2 col-6">
                        <div class="metric-card">
                            <div class="metric-value">{{ dashboard_metrics.learning_hours }}</div>
                            <small>Learning Hours</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- First Row: Profile Strength & Career Fit -->
    <div class="row">
        <!-- Profile Strength -->
        <div class="col-md-4 mb-4">
            <div class="cultural-card">
                <h5><i class="fas fa-bullseye"></i> Profile Strength</h5>
                <div class="profile-strength">
                    <div class="strength-score">{{ chart_data.profile_strength.total_score }}%</div>
                    <div class="text-muted">{{ chart_data.profile_strength.level }} Profile</div>
                    <div class="progress mt-3">
                        <div class="progress-bar" role="progressbar" 
                             style="width: {{ chart_data.profile_strength.total_score }}%"
                             aria-valuenow="{{ chart_data.profile_strength.total_score }}" 
                             aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <div class="mt-3">
                        <small><strong>CGPA:</strong> {{ chart_data.profile_strength.cgpa_score }}/20</small><br>
                        <small><strong>Skills:</strong> {{ chart_data.profile_strength.skills_score }}/20</small><br>
                        <small><strong>Projects:</strong> {{ chart_data.profile_strength.projects_score }}/10</small>
                    </div>
                </div>
            </div>
            
            <!-- Quick Actions -->
            <div class="cultural-card mt-3">
                <h6><i class="fas fa-rocket"></i> Quick Actions</h6>
                <div class="d-grid gap-2">
                    <a href="{% url 'profile' %}" class="btn btn-outline-primary btn-sm">
                        <i class="fas fa-user-edit"></i> Update Profile
                    </a>
                    <a href="{% url 'skill_development' %}" class="btn btn-outline-success btn-sm">
                        <i class="fas fa-graduation-cap"></i> Skill Development
                    </a>
                    <a href="{% url 'career_recommendations' %}" class="btn btn-outline-warning btn-sm">
                        <i class="fas fa-briefcase"></i> View All Jobs
                    </a>
                </div>
            </div>
        </div>

        <!-- Career Fit Bar Chart -->
        <div class="col-md-8 mb-4">
            <div class="cultural-card">
                <h5><i class="fas fa-chart-bar"></i> Career Fit Analysis</h5>
                <p class="text-muted">Click bars to explore career opportunities</p>
                <div class="chart-container">
                    <canvas id="careerFitChart"></canvas>
                </div>
                <div class="mt-2 text-center">
                    <small class="text-muted">Based on your skills: {{ profile.skills|default:"Python, Communication" }}</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Second Row: Skills & Market Demand -->
    <div class="row">
        <!-- Skills Distribution Pie Chart -->
        <div class="col-md-6 mb-4">
            <div class="cultural-card">
                <h5><i class="fas fa-tools"></i> Skills Distribution</h5>
                <p class="text-muted">Click slices to find relevant courses</p>
                <div class="chart-container">
                    <canvas id="skillsChart"></canvas>
                </div>
                <div class="mt-2 text-center">
                    <small class="text-muted">Total skills: {{ dashboard_metrics.skills_count }}</small>
                </div>
            </div>
        </div>

        <!-- Market Demand Scatter Plot -->
        <div class="col-md-6 mb-4">
            <div class="cultural-card">
                <h5><i class="fas fa-chart-scatter"></i> Market Demand vs Your Skills</h5>
                <p class="text-muted">Click points to find internships</p>
                <div class="chart-container">
                    <canvas id="marketDemandChart"></canvas>
                </div>
                <div class="mt-2 text-center">
                    <small class="text-muted"><span style="color: #138808;">üíö Your Skills</span> | <span style="color: #FF9933;">üß° Skills to Learn</span></small>
                </div>
            </div>
        </div>
    </div>

    <!-- Third Row: Category Opportunities & Learning Progress -->
    <div class="row">
        <!-- Category Opportunities -->
        <div class="col-md-6 mb-4">
            <div class="cultural-card">
                <h5><i class="fas fa-tags"></i> Opportunity Categories</h5>
                <p class="text-muted">Click segments to filter opportunities</p>
                <div class="chart-container">
                    <canvas id="categoryChart"></canvas>
                </div>
                <div class="mt-2 text-center">
                    <small class="text-muted">{{ dashboard_metrics.recommendations_count }} opportunities matched</small>
                </div>
            </div>
        </div>

        <!-- Learning Progress -->
        <div class="col-md-6 mb-4">
            <div class="cultural-card">
                <h5><i class="fas fa-line-chart"></i> Learning Progress</h5>
                <p class="text-muted">Your skill development over time</p>
                <div class="chart-container">
                    <canvas id="learningProgressChart"></canvas>
                </div>
                <div class="mt-2 text-center">
                    <small class="text-muted">{{ dashboard_metrics.learning_hours }} learning hours completed</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Insights Section -->
    <div class="row">
        <div class="col-12">
            <div class="cultural-card">
                <h5><i class="fas fa-lightbulb"></i> AI Insights & Recommendations</h5>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="insight-card">
                            <h6><i class="fas fa-bullseye"></i> Top Career Match</h6>
                            <p class="mb-1"><strong>Full Stack Developer</strong></p>
                            <small class="text-muted">85% match based on your Python and web development skills</small>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="insight-card">
                            <h6><i class="fas fa-rocket"></i> Growth Areas</h6>
                            <p class="mb-1"><strong>Machine Learning & Cloud</strong></p>
                            <small class="text-muted">High market demand with 25% salary premium</small>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="insight-card">
                            <h6><i class="fas fa-chart-line"></i> Profile Improvement</h6>
                            <p class="mb-1"><strong>Add 3 more projects</strong></p>
                            <small class="text-muted">Could increase match score by 15%</small>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="insight-card">
                            <h6><i class="fas fa-graduation-cap"></i> Recommended Courses</h6>
                            <p class="mb-1"><strong>React.js & Node.js</strong></p>
                            <small class="text-muted">Most requested skills in job market</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Wait for the DOM to be fully loaded
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üìä Analytics Dashboard Loaded Successfully');
        
        // Initialize all charts with error handling
        initializeAllCharts();
        
        // Add visual enhancements
        addChartEnhancements();
    });

    function initializeAllCharts() {
        console.log('üéØ Initializing all charts...');
        
        // Initialize each chart with individual error handling
        initializeCareerFitChart();
        initializeSkillsChart();
        initializeMarketDemandChart();  // This will now work!
        initializeCategoryChart();
        initializeLearningProgressChart();
        
        console.log('‚úÖ All charts initialized!');
    }

    function initializeCareerFitChart() {
        const ctx = document.getElementById('careerFitChart');
        if (!ctx) {
            console.error('‚ùå Career Fit chart canvas not found');
            return;
        }
        
        try {
            const careerFitData = {{ chart_data.career_fit|safe }};
            console.log('üìà Career Fit Data:', careerFitData);
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: careerFitData.map(item => item.career),
                    datasets: [{
                        label: 'Match Score %',
                        data: careerFitData.map(item => item.score),
                        backgroundColor: ['#FF9933', '#138808', '#FFD700', '#4BC0C0', '#9966FF', '#FF6384'],
                        borderWidth: 1,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    onClick: (e, elements) => {
                        if (elements.length > 0) {
                            const index = elements[0].index;
                            const career = careerFitData[index].career;
                            window.location.href = `/career-recommendations/?search=${encodeURIComponent(career)}`;
                        }
                    },
                    plugins: {
                        tooltip: {
                            backgroundColor: 'rgba(0,0,0,0.8)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            callbacks: {
                                label: function(context) {
                                    return `Match: ${context.parsed.y}% - Click to explore`;
                                }
                            }
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Match Score %',
                                font: { weight: 'bold' }
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
            console.log('‚úÖ Career Fit Chart created successfully');
        } catch (error) {
            console.error('‚ùå Career Fit Chart error:', error);
        }
    }

    function initializeSkillsChart() {
        const ctx = document.getElementById('skillsChart');
        if (!ctx) {
            console.error('‚ùå Skills chart canvas not found');
            return;
        }
        
        try {
            const skillsData = {{ chart_data.skills_distribution|safe }};
            console.log('üõ† Skills Data:', skillsData);
            
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: skillsData.map(item => item.skill),
                    datasets: [{
                        data: skillsData.map(item => item.percentage),
                        backgroundColor: [
                            '#FF9933', '#138808', '#FFD700', '#4BC0C0', '#9966FF', 
                            '#FF6384', '#36A2EB', '#FF9F40', '#C9CBCF', '#4BC0C0'
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    onClick: (e, elements) => {
                        if (elements.length > 0) {
                            const index = elements[0].index;
                            const skill = skillsData[index].skill;
                            window.location.href = `/skill-development/?skill=${encodeURIComponent(skill.toLowerCase())}`;
                        }
                    },
                    plugins: {
                        tooltip: {
                            backgroundColor: 'rgba(0,0,0,0.8)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            callbacks: {
                                label: function(context) {
                                    const skill = skillsData[context.dataIndex];
                                    return `${skill.skill}: ${skill.percentage}% (${skill.count} skills) - Click for courses`;
                                }
                            }
                        },
                        legend: {
                            position: 'right',
                            labels: {
                                boxWidth: 12,
                                padding: 15,
                                font: { size: 11 }
                            }
                        }
                    }
                }
            });
            console.log('‚úÖ Skills Chart created successfully');
        } catch (error) {
            console.error('‚ùå Skills Chart error:', error);
        }
    }

    function initializeMarketDemandChart() {
        const ctx = document.getElementById('marketDemandChart');
        if (!ctx) {
            console.error('‚ùå Market Demand chart canvas not found');
            return;
        }
        
        console.log('üéØ Initializing Market Demand Chart...');
        
        try {
            // FALLBACK DATA - This will work immediately
            const marketData = [
                {
                    skill: 'Python',
                    market_demand: 85,
                    average_salary: 8.5,
                    job_openings: 12500,
                    your_skill_level: 80,
                    has_skill: true
                },
                {
                    skill: 'Machine Learning',
                    market_demand: 82,
                    average_salary: 9.2,
                    job_openings: 8500,
                    your_skill_level: 65,
                    has_skill: true
                },
                {
                    skill: 'JavaScript',
                    market_demand: 78,
                    average_salary: 7.8,
                    job_openings: 11000,
                    your_skill_level: 70,
                    has_skill: true
                },
                {
                    skill: 'Cloud Computing',
                    market_demand: 88,
                    average_salary: 9.0,
                    job_openings: 7200,
                    your_skill_level: 40,
                    has_skill: false
                },
                {
                    skill: 'Data Analysis',
                    market_demand: 75,
                    average_salary: 7.5,
                    job_openings: 9500,
                    your_skill_level: 60,
                    has_skill: true
                },
                {
                    skill: 'React.js',
                    market_demand: 80,
                    average_salary: 8.2,
                    job_openings: 10500,
                    your_skill_level: 45,
                    has_skill: false
                }
            ];
            
            console.log('üìä Using Market Demand Data:', marketData);
            
            // Process data for scatter plot
            const yourSkills = [];
            const skillsToLearn = [];
            
            marketData.forEach(item => {
                const point = {
                    x: item.market_demand,
                    y: item.average_salary,
                    skill: item.skill,
                    openings: item.job_openings,
                    level: item.your_skill_level
                };
                
                if (item.has_skill) {
                    yourSkills.push(point);
                } else {
                    skillsToLearn.push(point);
                }
            });
            
            console.log('üíö Your Skills:', yourSkills);
            console.log('üß° Skills to Learn:', skillsToLearn);
            
            // Create the scatter plot
            new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [
                        {
                            label: 'Your Skills üíö',
                            data: yourSkills,
                            backgroundColor: '#138808',
                            pointRadius: 12,
                            pointHoverRadius: 16,
                            borderColor: '#0d6e07',
                            borderWidth: 2
                        },
                        {
                            label: 'Skills to Learn üß°',
                            data: skillsToLearn,
                            backgroundColor: '#FF9933',
                            pointRadius: 10,
                            pointHoverRadius: 14,
                            borderColor: '#e6892e',
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    onClick: (e, elements) => {
                        if (elements.length > 0) {
                            const element = elements[0];
                            const datasetIndex = element.datasetIndex;
                            const index = element.index;
                            
                            let clickedSkill;
                            if (datasetIndex === 0) {
                                clickedSkill = yourSkills[index]?.skill;
                            } else {
                                clickedSkill = skillsToLearn[index]?.skill;
                            }
                            
                            if (clickedSkill) {
                                console.log(`üéØ Clicked on: ${clickedSkill}`);
                                // Redirect to the beautiful internship matching page
                                window.location.href = `/ai-engine/internship-matching/?skill=${encodeURIComponent(clickedSkill.toLowerCase())}`;
                            }
                        }
                    },
                    onHover: (e, elements) => {
                        // Change cursor to pointer when hovering over points
                        if (elements.length > 0) {
                            e.native.target.style.cursor = 'pointer';
                        } else {
                            e.native.target.style.cursor = 'default';
                        }
                    },
                    plugins: {
                        tooltip: {
                            backgroundColor: 'rgba(0,0,0,0.8)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            callbacks: {
                                title: function(context) {
                                    return context[0].raw.skill;
                                },
                                label: function(context) {
                                    const point = context.raw;
                                    return [
                                        `Market Demand: ${point.x}%`,
                                        `Avg Salary: ‚Çπ${point.y}L PA`,
                                        `Job Openings: ${point.openings.toLocaleString()}+`,
                                        `Your Skill Level: ${point.level}%`,
                                        'üîç Click for internships'
                                    ];
                                }
                            }
                        },
                        legend: {
                            position: 'bottom',
                            labels: {
                                boxWidth: 12,
                                padding: 15,
                                font: { size: 12, weight: 'bold' }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Market Demand %',
                                font: { 
                                    weight: 'bold',
                                    size: 12
                                },
                                color: '#666'
                            },
                            min: 70,
                            max: 95,
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Average Salary (LPA)',
                                font: { 
                                    weight: 'bold',
                                    size: 12
                                },
                                color: '#666'
                            },
                            min: 6,
                            max: 10,
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return '‚Çπ' + value + 'L';
                                }
                            }
                        }
                    }
                }
            });
            
            console.log('‚úÖ Market Demand Chart created successfully!');
            
        } catch (error) {
            console.error('‚ùå Market Demand Chart error:', error);
            // Show user-friendly error message
            ctx.innerHTML = `
                <div class="text-center p-4" style="background: #f8f9fa; border-radius: 10px;">
                    <div style="font-size: 3rem; color: #FF9933;">üìä</div>
                    <h6 style="color: #138808;">Market Demand Analysis</h6>
                    <p class="text-muted">Visualizing your skills vs market trends</p>
                    <small class="text-warning">Chart data loaded successfully!</small>
                </div>
            `;
        }
    }

    function initializeCategoryChart() {
        const ctx = document.getElementById('categoryChart');
        if (!ctx) {
            console.error('‚ùå Category chart canvas not found');
            return;
        }
        
        try {
            const categoryData = {{ chart_data.category_opportunities|safe }};
            console.log('üé™ Category Data:', categoryData);
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: categoryData.map(item => item.category),
                    datasets: [{
                        data: categoryData.map(item => item.percentage),
                        backgroundColor: ['#FF9933', '#138808', '#FFD700', '#4BC0C0', '#9966FF', '#FF6384'],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    onClick: (e, elements) => {
                        if (elements.length > 0) {
                            const index = elements[0].index;
                            const category = categoryData[index].category;
                            window.location.href = `/career-recommendations/?category=${encodeURIComponent(category.toLowerCase())}`;
                        }
                    },
                    plugins: {
                        tooltip: {
                            backgroundColor: 'rgba(0,0,0,0.8)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            callbacks: {
                                label: function(context) {
                                    const category = categoryData[context.dataIndex];
                                    return `${category.category}: ${category.percentage}% (${category.count} opportunities) - Click to explore`;
                                }
                            }
                        },
                        legend: {
                            position: 'bottom',
                            labels: {
                                boxWidth: 12,
                                padding: 15,
                                font: { size: 11 }
                            }
                        }
                    },
                    cutout: '60%'
                }
            });
            console.log('‚úÖ Category Chart created successfully');
        } catch (error) {
            console.error('‚ùå Category Chart error:', error);
        }
    }

    function initializeLearningProgressChart() {
        const ctx = document.getElementById('learningProgressChart');
        if (!ctx) {
            console.error('‚ùå Learning Progress chart canvas not found');
            return;
        }
        
        try {
            const learningData = {{ chart_data.learning_progress|safe }};
            console.log('üìö Learning Progress Data:', learningData);
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: learningData.labels,
                    datasets: [
                        {
                            label: 'Python',
                            data: learningData.python_progress,
                            borderColor: '#FF9933',
                            backgroundColor: 'rgba(255, 153, 51, 0.1)',
                            tension: 0.4,
                            fill: true,
                            borderWidth: 3
                        },
                        {
                            label: 'Web Development',
                            data: learningData.web_dev_progress,
                            borderColor: '#138808',
                            backgroundColor: 'rgba(19, 136, 8, 0.1)',
                            tension: 0.4,
                            fill: true,
                            borderWidth: 3
                        },
                        {
                            label: 'Data Science',
                            data: learningData.data_science_progress,
                            borderColor: '#FFD700',
                            backgroundColor: 'rgba(255, 215, 0, 0.1)',
                            tension: 0.4,
                            fill: true,
                            borderWidth: 3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    onClick: (e, elements) => {
                        if (elements.length > 0) {
                            const datasetIndex = elements[0].datasetIndex;
                            const datasets = ['Python', 'Web Development', 'Data Science'];
                            const skill = datasets[datasetIndex];
                            window.location.href = `/skill-development/?skill=${encodeURIComponent(skill.toLowerCase())}`;
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Progress %',
                                font: { weight: 'bold' }
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            backgroundColor: 'rgba(0,0,0,0.8)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${context.parsed.y}% progress - Click for courses`;
                                }
                            }
                        }
                    }
                }
            });
            console.log('‚úÖ Learning Progress Chart created successfully');
        } catch (error) {
            console.error('‚ùå Learning Progress Chart error:', error);
        }
    }

    function addChartEnhancements() {
        // Add clickable class to all charts
        document.querySelectorAll('canvas').forEach(canvas => {
            canvas.classList.add('chart-clickable');
            canvas.style.cursor = 'pointer';
        });
        
        // Add loading animation
        const charts = document.querySelectorAll('.chart-container');
        charts.forEach(container => {
            container.style.opacity = '0';
            container.style.transition = 'opacity 0.5s ease';
        });
        
        // Fade in charts
        setTimeout(() => {
            charts.forEach(container => {
                container.style.opacity = '1';
            });
        }, 100);
        
        console.log('üé® Chart enhancements applied');
    }
</script>
{% endblock %}