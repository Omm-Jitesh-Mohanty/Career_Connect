<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CareerPal AI - Advanced Career Assistant</title>
    
    <!-- Bootstrap & Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --ai-gradient: linear-gradient(135deg, #00b09b, #96c93d);
            --user-gradient: linear-gradient(135deg, #ff7e5f, #feb47b);
            --card-shadow: 0 10px 40px rgba(0,0,0,0.1);
            --message-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        
        /* Language Notification */
        .language-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #667eea;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            z-index: 10000;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        /* Header */
        .ai-header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 20px 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .ai-brand {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .ai-avatar {
            width: 50px;
            height: 50px;
            background: var(--ai-gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .brand-text h1 {
            font-size: 1.8rem;
            font-weight: 800;
            margin: 0;
            background: linear-gradient(135deg, #ffffff, #a8edea);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .brand-text p {
            font-size: 0.9rem;
            opacity: 0.9;
            margin: 5px 0 0 0;
        }
        
        .header-actions {
            display: flex;
            gap: 15px;
        }
        
        .header-btn {
            background: rgba(255, 255, 255, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .header-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
            color: white;
            text-decoration: none;
        }
        
        /* Audio Controls */
        .audio-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            background: rgba(248, 249, 250, 0.9);
            border-radius: 12px;
            margin: 0 10px;
            flex-wrap: wrap;
        }
        
        .voice-input-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            border: 2px solid #667eea;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #667eea;
        }
        
        .voice-input-btn:hover {
            background: #667eea;
            color: white;
        }
        
        .voice-input-btn.recording {
            background: #ff4757;
            border-color: #ff4757;
            color: white;
            animation: pulse-recording 1.5s infinite;
        }
        
        @keyframes pulse-recording {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 71, 87, 0.7); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(255, 71, 87, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 71, 87, 0); }
        }
        
        .language-selector {
            padding: 8px 12px;
            border: 2px solid #e9ecef;
            border-radius: 20px;
            background: white;
            font-size: 14px;
            color: #555;
            cursor: pointer;
            min-width: 120px;
        }
        
        .audio-toggle-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            color: #555;
            transition: all 0.3s ease;
        }
        
        .audio-toggle-btn:hover {
            border-color: #667eea;
            color: #667eea;
        }
        
        .audio-toggle-btn.active {
            background: #667eea;
            border-color: #667eea;
            color: white;
        }
        
        .recording-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #ff4757;
            font-size: 14px;
            font-weight: 500;
        }
        
        .recording-dot {
            width: 10px;
            height: 10px;
            background: #ff4757;
            border-radius: 50%;
            animation: blink 1.5s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }
        
        /* Audio Player in Messages */
        .audio-player-container {
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .play-audio-btn {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 6px 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s ease;
        }
        
        .play-audio-btn:hover {
            background: #764ba2;
        }
        
        .play-audio-btn.playing {
            background: #4CAF50;
        }
        
        /* Main Container */
        .ai-container {
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 20px;
            display: flex;
            gap: 25px;
        }
        
        /* Sidebar */
        .ai-sidebar {
            width: 320px;
            flex-shrink: 0;
        }
        
        .sidebar-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--card-shadow);
        }
        
        .user-profile {
            text-align: center;
        }
        
        .user-avatar {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            color: white;
        }
        
        .user-info h3 {
            font-size: 1.3rem;
            margin-bottom: 5px;
            color: #333;
        }
        
        .user-info p {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }
        
        .user-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }
        
        .stat {
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #667eea;
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
        }
        
        .quick-actions h4 {
            font-size: 1rem;
            color: #444;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .action-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .action-btn {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .action-btn:hover {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-color: #667eea;
            transform: translateY(-3px);
        }
        
        .action-btn i {
            font-size: 24px;
            color: #667eea;
        }
        
        .action-btn span {
            font-size: 0.85rem;
            font-weight: 600;
            color: #444;
        }
        
        .progress-card h4 {
            font-size: 1rem;
            color: #444;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .progress-item {
            margin-bottom: 20px;
        }
        
        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: #555;
        }
        
        .progress-bar {
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 4px;
            transition: width 1s ease;
        }
        
        /* Chat Area */
        .ai-chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: white;
            border-radius: 20px;
            box-shadow: var(--card-shadow);
            overflow: hidden;
        }
        
        .chat-header {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 15px 30px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .chat-header h3 {
            font-size: 1.3rem;
            color: #333;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .ai-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            color: #666;
            margin-top: 5px;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            background: #4CAF50;
            border-radius: 50%;
            animation: blink 2s infinite;
        }
        
        .chat-messages {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            background: #fafbfc;
            max-height: 60vh;
        }
        
        .message {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            animation: slideIn 0.3s ease;
        }
        
        .ai-message .message-avatar {
            background: var(--ai-gradient);
        }
        
        .user-message {
            flex-direction: row-reverse;
        }
        
        .user-message .message-avatar {
            background: var(--user-gradient);
        }
        
        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
            flex-shrink: 0;
        }
        
        .message-content {
            max-width: 70%;
            padding: 20px;
            border-radius: 20px;
            background: white;
            box-shadow: var(--message-shadow);
            line-height: 1.6;
        }
        
        .ai-message .message-content {
            border-bottom-left-radius: 5px;
        }
        
        .user-message .message-content {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-bottom-right-radius: 5px;
        }
        
        .message-content p {
            margin: 0;
        }
        
        .message-content strong {
            color: #667eea;
        }
        
        .message-content ul, .message-content ol {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .typing-indicator {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .typing-dots {
            display: flex;
            gap: 5px;
        }
        
        .typing-dots span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #666;
            animation: typing 1.4s infinite ease-in-out;
        }
        
        .typing-dots span:nth-child(1) { animation-delay: -0.32s; }
        .typing-dots span:nth-child(2) { animation-delay: -0.16s; }
        
        /* Suggestions */
        .message-suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 15px;
        }
        
        .suggestion-btn {
            padding: 10px 20px;
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            color: #555;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .suggestion-btn:hover {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: transparent;
            transform: translateY(-2px);
        }
        
        /* Input Area */
        .chat-input-area {
            padding: 25px 30px;
            border-top: 1px solid #e9ecef;
            background: white;
        }
        
        .input-container {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .file-upload-btn {
            width: 50px;
            height: 50px;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #666;
        }
        
        .file-upload-btn:hover {
            background: #f8f9fa;
            color: #667eea;
            border-color: #667eea;
        }
        
        .message-input {
            flex: 1;
            height: 50px;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 0 20px;
            font-size: 15px;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
        }
        
        .message-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .send-btn {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
        }
        
        .send-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .quick-actions-bar {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        
        .quick-action {
            padding: 10px 20px;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85rem;
            color: #555;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .quick-action:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        /* Welcome Screen */
        .welcome-screen {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        }
        
        .welcome-content {
            text-align: center;
            max-width: 600px;
        }
        
        .welcome-icon {
            font-size: 80px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 30px;
        }
        
        .welcome-content h2 {
            font-size: 2.5rem;
            font-weight: 800;
            color: #333;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .welcome-content p {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 40px;
            line-height: 1.6;
        }
        
        .feature-cards {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
            margin-top: 40px;
        }
        
        .feature-card {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
            border: 3px solid transparent;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
            border-color: #667eea;
        }
        
        .feature-card i {
            font-size: 40px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
        }
        
        .feature-card h5 {
            font-size: 1.2rem;
            color: #333;
            margin-bottom: 10px;
        }
        
        .feature-card p {
            font-size: 0.95rem;
            color: #666;
            margin: 0;
        }
        
        /* Responsive */
        @media (max-width: 1200px) {
            .ai-container {
                flex-direction: column;
            }
            
            .ai-sidebar {
                width: 100%;
            }
            
            .action-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .feature-cards {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .action-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .feature-cards {
                grid-template-columns: 1fr;
            }
            
            .message-content {
                max-width: 85%;
            }
            
            .quick-actions-bar {
                justify-content: flex-start;
                overflow-x: auto;
            }
            
            .audio-controls {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <div class="ai-agent-page">
        <!-- Header -->
        <header class="ai-header">
            <div class="header-content">
                <div class="ai-brand">
                    <div class="ai-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="brand-text">
                        <h1>CareerPal AI</h1>
                        <p>Advanced Career Assistant ‚Ä¢ BPUT Career Connect</p>
                    </div>
                </div>
                <div class="header-actions">
                    <a href="{% url 'home' %}" class="header-btn">
                        <i class="fas fa-home"></i>
                        Home
                    </a>
                    <a href="{% url 'dashboard' %}" class="header-btn">
                        <i class="fas fa-tachometer-alt"></i>
                        Dashboard
                    </a>
                </div>
            </div>
        </header>
        
        <!-- Main Container -->
        <div class="ai-container">
            <!-- Sidebar -->
            <aside class="ai-sidebar">
                <!-- User Profile -->
                <div class="sidebar-card user-profile">
                    <div class="user-avatar">
                        <i class="fas fa-user-graduate"></i>
                    </div>
                    <div class="user-info">
                        <h3 id="userName">BPUT Student</h3>
                        <p id="userDept">Computer Science</p>
                        <div class="user-stats">
                            <div class="stat">
                                <div class="stat-value" id="profileScore">75%</div>
                                <div class="stat-label">Profile</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value" id="skillScore">60%</div>
                                <div class="stat-label">Skills</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value" id="internshipScore">3</div>
                                <div class="stat-label">Applied</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Actions -->
                <div class="sidebar-card quick-actions">
                    <h4>Quick Actions</h4>
                    <div class="action-grid">
                        <div class="action-btn" data-action="cv-analysis">
                            <i class="fas fa-file-alt"></i>
                            <span>CV Analysis</span>
                        </div>
                        <div class="action-btn" data-action="internship-search">
                            <i class="fas fa-briefcase"></i>
                            <span>Find Internships</span>
                        </div>
                        <div class="action-btn" data-action="skill-analysis">
                            <i class="fas fa-chart-line"></i>
                            <span>Skill Analysis</span>
                        </div>
                        <div class="action-btn" data-action="interview-prep">
                            <i class="fas fa-user-graduate"></i>
                            <span>Interview Prep</span>
                        </div>
                        <div class="action-btn" data-action="career-guidance">
                            <i class="fas fa-road"></i>
                            <span>Career Roadmap</span>
                        </div>
                        <div class="action-btn" data-action="upload-cv">
                            <i class="fas fa-upload"></i>
                            <span>Upload CV</span>
                        </div>
                        <div class="action-btn" data-action="mock-interview">
                            <i class="fas fa-microphone"></i>
                            <span>Mock Interview</span>
                        </div>
                        <div class="action-btn" data-action="progress-tracker">
                            <i class="fas fa-tasks"></i>
                            <span>Progress Tracker</span>
                        </div>
                    </div>
                </div>
                
                <!-- Progress -->
                <div class="sidebar-card progress-card">
                    <h4>Your Progress</h4>
                    <div class="progress-item">
                        <div class="progress-label">
                            <span>Profile Completion</span>
                            <span>75%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 75%"></div>
                        </div>
                    </div>
                    <div class="progress-item">
                        <div class="progress-label">
                            <span>Skill Development</span>
                            <span>60%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 60%"></div>
                        </div>
                    </div>
                    <div class="progress-item">
                        <div class="progress-label">
                            <span>Interview Readiness</span>
                            <span>45%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 45%"></div>
                        </div>
                    </div>
                    <div class="progress-item">
                        <div class="progress-label">
                            <span>Application Success</span>
                            <span>30%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 30%"></div>
                        </div>
                    </div>
                </div>
            </aside>
            
            <!-- Chat Area -->
            <main class="ai-chat-area">
                <!-- Welcome Screen -->
                <div class="welcome-screen" id="welcomeScreen">
                    <div class="welcome-content">
                        <div class="welcome-icon">
                            <i class="fas fa-robot"></i>
                        </div>
                        <h2>Welcome to CareerPal AI! ü§ñ</h2>
                        <p>Your intelligent career assistant powered by advanced AI. I'm here to help you navigate your career journey with personalized guidance, real opportunities, and actionable insights.</p>
                        
                        <div class="feature-cards">
                            <div class="feature-card">
                                <i class="fas fa-file-alt"></i>
                                <h5>Smart CV Analysis</h5>
                                <p>ATS optimization & professional enhancement</p>
                            </div>
                            <div class="feature-card">
                                <i class="fas fa-briefcase"></i>
                                <h5>Real Internships</h5>
                                <p>Personalized opportunity matching</p>
                            </div>
                            <div class="feature-card">
                                <i class="fas fa-chart-line"></i>
                                <h5>Skill Intelligence</h5>
                                <p>Gap analysis & learning paths</p>
                            </div>
                            <div class="feature-card">
                                <i class="fas fa-user-graduate"></i>
                                <h5>Interview Mastery</h5>
                                <p>Mock interviews & preparation</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Chat Interface -->
                <div class="chat-interface" id="chatInterface" style="display: none;">
                    <!-- Chat Header with Audio Controls -->
                    <div class="chat-header">
                        <h3>
                            <i class="fas fa-robot"></i>
                            CareerPal AI
                            <div class="ai-status">
                                <span class="status-dot"></span>
                                <span>Online ‚Ä¢ Ready to assist</span>
                            </div>
                        </h3>
                        
                        <!-- Audio Controls -->
                        <div class="audio-controls">
                            <button class="voice-input-btn" id="voiceInputBtn" title="Voice Input">
                                <i class="fas fa-microphone"></i>
                            </button>
                            <div id="recordingIndicator" class="recording-indicator" style="display: none;">
                                <div class="recording-dot"></div>
                                <span>Recording...</span>
                            </div>
                            
                            <select class="language-selector" id="languageSelector">
                                <option value="en">üá¨üáß English</option>
                                <option value="hi">üáÆüá≥ ‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
                                <option value="ta">üáÆüá≥ ‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</option>
                                <option value="te">üáÆüá≥ ‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
                                <option value="kn">üáÆüá≥ ‡≤ï‡≤®‡≥ç‡≤®‡≤°</option>
                                <option value="ml">üáÆüá≥ ‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç</option>
                                <option value="bn">üáÆüá≥ ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</option>
                                <option value="mr">üáÆüá≥ ‡§Æ‡§∞‡§æ‡§†‡•Ä</option>
                                <option value="gu">üáÆüá≥ ‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä</option>
                                <option value="or">üáÆüá≥ ‡¨ì‡¨°‡¨º‡¨ø‡¨Ü</option>
                            </select>
                            
                            <button class="audio-toggle-btn active" id="toggleAudioBtn">
                                <i class="fas fa-volume-up"></i>
                                <span>Audio On</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Chat Messages -->
                    <div class="chat-messages" id="chatMessages">
                        <!-- Messages will be inserted here -->
                    </div>
                    
                    <!-- Message Suggestions -->
                    <div class="message-suggestions" id="messageSuggestions">
                        <!-- Suggestions will be inserted here -->
                    </div>
                    
                    <!-- Chat Input -->
                    <div class="chat-input-area">
                        <div class="input-container">
                            <input type="file" id="cvUpload" accept=".pdf,.doc,.docx" hidden>
                            <div class="file-upload-btn" id="attachBtn" title="Attach File">
                                <i class="fas fa-paperclip"></i>
                            </div>
                            <input type="text" id="userMessage" 
                                   placeholder="Type your message or click the microphone to speak..." 
                                   class="message-input">
                            <button class="send-btn" id="sendMessage" title="Send Message">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                        
                        <div class="quick-actions-bar">
                            <div class="quick-action" data-action="find-internships">
                                <i class="fas fa-briefcase"></i>
                                Find Internships
                            </div>
                            <div class="quick-action" data-action="analyze-cv">
                                <i class="fas fa-file-alt"></i>
                                Analyze CV
                            </div>
                            <div class="quick-action" data-action="skill-gaps">
                                <i class="fas fa-chart-line"></i>
                                Skill Analysis
                            </div>
                            <div class="quick-action" data-action="interview-prep">
                                <i class="fas fa-user-graduate"></i>
                                Interview Prep
                            </div>
                            <div class="quick-action" data-action="career-roadmap">
                                <i class="fas fa-road"></i>
                                Career Roadmap
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
    // Audio Manager Class
    class AudioManager {
        constructor() {
            this.audioEnabled = true;
            this.currentLanguage = 'en';
            this.isRecording = false;
            this.mediaRecorder = null;
            this.audioChunks = [];
            this.recognition = null;
            this.currentAudio = null;
            
            this.initializeAudio();
            this.setupEventListeners();
        }
        
        initializeAudio() {
            // Check browser support for speech recognition
            this.supportsSpeechRecognition = 'webkitSpeechRecognition' in window || 'SpeechRecognition' in window;
            
            if (this.supportsSpeechRecognition) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                this.recognition = new SpeechRecognition();
                this.recognition.continuous = false;
                this.recognition.interimResults = false;
                this.recognition.maxAlternatives = 1;
                
                this.recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    document.getElementById('userMessage').value = transcript;
                    
                    // Auto-send the message
                    if (window.aiAgent && transcript.trim()) {
                        window.aiAgent.sendMessage();
                    }
                };
                
                this.recognition.onerror = (event) => {
                    console.error('Speech recognition error:', event.error);
                    this.stopRecording();
                };
                
                this.recognition.onend = () => {
                    this.stopRecording();
                };
            }
        }
        
        setupEventListeners() {
            // Voice input button
            const voiceBtn = document.getElementById('voiceInputBtn');
            if (voiceBtn) {
                voiceBtn.addEventListener('click', () => {
                    if (this.isRecording) {
                        this.stopRecording();
                    } else {
                        this.startRecording();
                    }
                });
            }
            
            // Toggle audio button
            const toggleBtn = document.getElementById('toggleAudioBtn');
            if (toggleBtn) {
                toggleBtn.addEventListener('click', () => {
                    this.toggleAudio();
                });
            }
            
            // Language selector
            const languageSelect = document.getElementById('languageSelector');
            if (languageSelect) {
                languageSelect.addEventListener('change', (e) => {
                    this.changeLanguage(e.target.value);
                });
            }
        }
        
        async startRecording() {
            if (!this.supportsSpeechRecognition) {
                alert('Voice input is not supported in your browser. Please use Chrome or Edge for this feature.');
                return;
            }
            
            try {
                // Check microphone permission
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                stream.getTracks().forEach(track => track.stop());
                
                this.isRecording = true;
                
                // Update UI
                const voiceBtn = document.getElementById('voiceInputBtn');
                const indicator = document.getElementById('recordingIndicator');
                
                if (voiceBtn) voiceBtn.classList.add('recording');
                if (indicator) indicator.style.display = 'flex';
                
                // Start speech recognition
                if (this.recognition) {
                    this.recognition.lang = this.getLanguageCode();
                    this.recognition.start();
                }
                
            } catch (error) {
                console.error('Microphone access error:', error);
                alert('Please allow microphone access to use voice input.');
                this.stopRecording();
            }
        }
        
        stopRecording() {
            this.isRecording = false;
            
            // Update UI
            const voiceBtn = document.getElementById('voiceInputBtn');
            const indicator = document.getElementById('recordingIndicator');
            
            if (voiceBtn) voiceBtn.classList.remove('recording');
            if (indicator) indicator.style.display = 'none';
            
            // Stop recognition
            if (this.recognition) {
                this.recognition.stop();
            }
        }
        
        getLanguageCode() {
            const languageMap = {
                'en': 'en-IN',
                'hi': 'hi-IN',
                'ta': 'ta-IN',
                'te': 'te-IN',
                'kn': 'kn-IN',
                'ml': 'ml-IN',
                'bn': 'bn-IN',
                'mr': 'mr-IN',
                'gu': 'gu-IN',
                'or': 'or-IN'
            };
            return languageMap[this.currentLanguage] || 'en-IN';
        }
        
        async toggleAudio() {
            this.audioEnabled = !this.audioEnabled;
            
            // Update server
            try {
                const response = await fetch('/chatbot/toggle-audio/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': this.getCsrfToken()
                    },
                    body: JSON.stringify({ enabled: this.audioEnabled })
                });
                
                if (response.ok) {
                    console.log('Audio toggled:', this.audioEnabled);
                }
            } catch (error) {
                console.error('Toggle audio error:', error);
            }
            
            this.updateAudioUI();
        }
        
        async changeLanguage(language) {
            this.currentLanguage = language;
            
            try {
                const response = await fetch('/chatbot/change-language/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': this.getCsrfToken()
                    },
                    body: JSON.stringify({ language: language })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('Language changed to:', data.language_name);
                    
                    // Show notification
                    this.showLanguageNotification(`Switched to ${data.language_name}`);
                }
            } catch (error) {
                console.error('Change language error:', error);
            }
        }
        
        showLanguageNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'language-notification';
            notification.innerHTML = `
                <i class="fas fa-language"></i>
                <span>${message}</span>
            `;
            notification.style.animation = 'slideIn 0.3s ease';
            
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
        
        updateAudioUI() {
            const toggleBtn = document.getElementById('toggleAudioBtn');
            if (!toggleBtn) return;
            
            const icon = toggleBtn.querySelector('i');
            const text = toggleBtn.querySelector('span');
            
            if (this.audioEnabled) {
                icon.className = 'fas fa-volume-up';
                text.textContent = 'Audio On';
                toggleBtn.classList.add('active');
            } else {
                icon.className = 'fas fa-volume-mute';
                text.textContent = 'Audio Off';
                toggleBtn.classList.remove('active');
            }
        }
        
        async playTextAsSpeech(text) {
            if (!this.audioEnabled || !text) return;
            
            // Stop any currently playing audio
            if (this.currentAudio) {
                this.currentAudio.pause();
                this.currentAudio = null;
            }
            
            try {
                // Clean text for speech (remove markdown, emojis)
                const cleanText = this.cleanTextForSpeech(text);
                
                // Use browser's speech synthesis if available
                if ('speechSynthesis' in window) {
                    this.playWithSpeechSynthesis(cleanText);
                } else {
                    // Fallback to server-side TTS
                    await this.playWithServerTTS(cleanText);
                }
            } catch (error) {
                console.error('Text-to-speech error:', error);
            }
        }
        
        cleanTextForSpeech(text) {
            // Remove markdown formatting
            let cleanText = text
                .replace(/\*\*/g, '')
                .replace(/\*/g, '')
                .replace(/#/g, '')
                .replace(/`/g, '')
                .replace(/\[.*?\]\(.*?\)/g, '') // Remove links
                .replace(/<[^>]*>/g, ''); // Remove HTML tags
            
            // Replace common emojis with text
            const emojiMap = {
                'üéØ': 'Target',
                'üíº': 'Briefcase',
                'üìÑ': 'Document',
                'üé§': 'Microphone',
                'üöÄ': 'Rocket',
                'ü§ñ': 'Robot',
                'üôè': 'Namaste',
                '‚ú®': 'Sparkle',
                'üåü': 'Star',
                'üí°': 'Idea',
                'üìö': 'Books',
                '‚úÖ': 'Checkmark',
                '‚ö†Ô∏è': 'Warning',
                '‚è∞': 'Clock',
                '‚è±Ô∏è': 'Timer',
                'üéì': 'Graduation',
                'üîó': 'Link'
            };
            
            for (const [emoji, replacement] of Object.entries(emojiMap)) {
                cleanText = cleanText.replace(new RegExp(emoji, 'g'), replacement);
            }
            
            return cleanText;
        }
        
        playWithSpeechSynthesis(text) {
            if (!window.speechSynthesis) return;
            
            // Cancel any ongoing speech
            speechSynthesis.cancel();
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = this.getLanguageCode();
            utterance.rate = 1.0;
            utterance.pitch = 1.0;
            utterance.volume = 1.0;
            
            // Try to find a suitable voice
            const voices = speechSynthesis.getVoices();
            
            // Filter voices by current language
            const targetLang = this.currentLanguage;
            let selectedVoice = null;
            
            if (targetLang === 'en') {
                selectedVoice = voices.find(voice => 
                    voice.lang.startsWith('en-IN') || 
                    voice.lang.startsWith('en-GB') ||
                    voice.lang.startsWith('en-US')
                );
            } else if (targetLang === 'hi') {
                selectedVoice = voices.find(voice => voice.lang.startsWith('hi-'));
            } else if (targetLang === 'ta') {
                selectedVoice = voices.find(voice => voice.lang.startsWith('ta-'));
            } else if (targetLang === 'te') {
                selectedVoice = voices.find(voice => voice.lang.startsWith('te-'));
            } else if (targetLang === 'kn') {
                selectedVoice = voices.find(voice => voice.lang.startsWith('kn-'));
            } else if (targetLang === 'ml') {
                selectedVoice = voices.find(voice => voice.lang.startsWith('ml-'));
            } else if (targetLang === 'bn') {
                selectedVoice = voices.find(voice => voice.lang.startsWith('bn-'));
            } else if (targetLang === 'mr') {
                selectedVoice = voices.find(voice => voice.lang.startsWith('mr-'));
            } else if (targetLang === 'gu') {
                selectedVoice = voices.find(voice => voice.lang.startsWith('gu-'));
            } else if (targetLang === 'or') {
                selectedVoice = voices.find(voice => voice.lang.startsWith('or-'));
            }
            
            if (selectedVoice) {
                utterance.voice = selectedVoice;
            }
            
            utterance.onstart = () => {
                console.log(`Speech started in ${this.currentLanguage}`);
            };
            
            utterance.onend = () => {
                console.log('Speech ended');
            };
            
            speechSynthesis.speak(utterance);
        }
        
        async playWithServerTTS(text) {
            try {
                const response = await fetch('/chatbot/text-to-speech/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': this.getCsrfToken()
                    },
                    body: JSON.stringify({
                        text: text,
                        language: this.currentLanguage
                    })
                });
                
                if (response.ok) {
                    const audioBlob = await response.blob();
                    const audioUrl = URL.createObjectURL(audioBlob);
                    
                    this.currentAudio = new Audio(audioUrl);
                    this.currentAudio.play();
                    
                    // Clean up URL after playback
                    this.currentAudio.onended = () => {
                        URL.revokeObjectURL(audioUrl);
                        this.currentAudio = null;
                    };
                }
            } catch (error) {
                console.error('Server TTS error:', error);
            }
        }
        
        createAudioButton(text, messageId) {
            if (!this.audioEnabled) return '';
            
            return `
                <div class="audio-player-container">
                    <button class="play-audio-btn" onclick="window.audioManager.playTextAsSpeech('${this.escapeText(text)}')" data-message-id="${messageId}">
                        <i class="fas fa-play"></i>
                        <span>Listen</span>
                    </button>
                </div>
            `;
        }
        
        escapeText(text) {
            return text.replace(/'/g, "\\'").replace(/\n/g, ' ');
        }
        
        getCsrfToken() {
            const cookieValue = document.cookie
                .split('; ')
                .find(row => row.startsWith('csrftoken='))
                ?.split('=')[1];
            return cookieValue || '';
        }
        
        // Translation methods
        async translateText(text, targetLang) {
            try {
                const response = await fetch('/chatbot/translate-text/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': this.getCsrfToken()
                    },
                    body: JSON.stringify({
                        text: text,
                        target_language: targetLang,
                        source_language: 'auto'
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    return data.translated_text;
                }
                return text; // Return original if translation fails
            } catch (error) {
                console.error('Translation error:', error);
                return text;
            }
        }
        
        async detectLanguage(text) {
            try {
                const response = await fetch('/chatbot/detect-language/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': this.getCsrfToken()
                    },
                    body: JSON.stringify({
                        text: text
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    return data.detected_language;
                }
                return 'en'; // Default to English if detection fails
            } catch (error) {
                console.error('Language detection error:', error);
                return 'en';
            }
        }
    }
    
    // Enhanced CareerPal AI Agent
    class EnhancedCareerPalAIAgent {
        constructor() {
            this.conversationHistory = [];
            this.userContext = {};
            this.isProcessing = false;
            this.currentAction = 'chat';
            this.messageSuggestions = [
                "Find me Python internships",
                "Analyze my CV for ATS optimization",
                "Create a web development learning path",
                "Prepare me for technical interviews",
                "Help with career roadmap planning",
                "What skills should I learn for data science?",
                "Find civil engineering internships",
                "Mock interview for software developer role"
            ];
            this.messageCounter = 0;
            
            this.initializeComponents();
            this.loadUserContext();
            this.loadMessageSuggestions();
        }
        
        initializeComponents() {
            // Event Listeners
            document.getElementById('sendMessage').addEventListener('click', () => this.sendMessage());
            document.getElementById('userMessage').addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    this.sendMessage();
                }
            });
            
            // Sidebar actions
            document.querySelectorAll('.action-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const action = e.currentTarget.getAttribute('data-action');
                    this.handleAction(action);
                });
            });
            
            // Quick actions
            document.querySelectorAll('.quick-action').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const action = e.currentTarget.getAttribute('data-action');
                    this.handleQuickAction(action);
                });
            });
            
            // File upload
            document.getElementById('attachBtn').addEventListener('click', () => this.triggerFileUpload());
            document.getElementById('cvUpload').addEventListener('change', (e) => this.handleFileUpload(e));
            
            // Suggestion buttons
            this.messageSuggestionsContainer = document.getElementById('messageSuggestions');
        }
        
        async loadUserContext() {
            try {
                const response = await fetch('/chatbot/user-context/');
                if (response.ok) {
                    this.userContext = await response.json();
                    this.updateUserProfile();
                }
            } catch (error) {
                console.log('Using default user context');
                this.userContext = {
                    username: 'BPUT Student',
                    department: 'Computer Science',
                    skills: ['Python', 'Django', 'Web Development'],
                    year: '3rd Year'
                };
            }
        }
        
        updateUserProfile() {
            document.getElementById('userName').textContent = this.userContext.username || 'BPUT Student';
            document.getElementById('userDept').textContent = this.userContext.department || 'Computer Science';
            
            // Update progress scores based on context
            if (this.userContext.skills && this.userContext.skills.length > 3) {
                document.getElementById('skillScore').textContent = '80%';
                document.getElementById('profileScore').textContent = '85%';
            }
        }
        
        loadMessageSuggestions() {
            const suggestionsHTML = this.messageSuggestions.map(suggestion => `
                <button class="suggestion-btn" onclick="window.aiAgent.addQuickMessage('${suggestion}')">
                    <i class="fas fa-lightbulb"></i> ${suggestion}
                </button>
            `).join('');
            
            this.messageSuggestionsContainer.innerHTML = suggestionsHTML;
        }
        
        async sendMessage() {
            const messageInput = document.getElementById('userMessage');
            const message = messageInput.value.trim();
            
            if (!message || this.isProcessing) return;
            
            // Auto-detect language for non-English input
            await this.autoDetectLanguage(message);
            
            // Show chat interface if not visible
            this.showChatInterface();
            
            // Add user message
            this.addMessage(message, 'user');
            messageInput.value = '';
            
            // Show typing indicator
            this.showTypingIndicator();
            
            this.isProcessing = true;
            
            try {
                const response = await this.sendToAI(message);
                this.removeTypingIndicator();
                this.addMessage(response, 'agent');
                
                // Auto-play audio for AI response
                if (window.audioManager && window.audioManager.audioEnabled) {
                    setTimeout(() => {
                        window.audioManager.playTextAsSpeech(response);
                    }, 500);
                }
            } catch (error) {
                this.removeTypingIndicator();
                this.addMessage('I apologize, but I encountered an error. Please try again.', 'agent');
                console.error('AI Error:', error);
            }
            
            this.isProcessing = false;
        }
        
        async autoDetectLanguage(message) {
            try {
                const detectedLang = await window.audioManager.detectLanguage(message);
                if (detectedLang !== 'en') {
                    // Auto-switch language selector
                    const languageSelect = document.getElementById('languageSelector');
                    if (languageSelect && languageSelect.value !== detectedLang) {
                        languageSelect.value = detectedLang;
                        window.audioManager.currentLanguage = detectedLang;
                        
                        // Get language name for notification
                        const languageName = languageSelect.options[languageSelect.selectedIndex].text;
                        window.audioManager.showLanguageNotification(`Auto-switched to ${languageName}`);
                    }
                }
            } catch (error) {
                console.error('Auto language detection error:', error);
            }
        }
        
        addQuickMessage(message) {
            document.getElementById('userMessage').value = message;
            this.sendMessage();
        }
        
        async sendToAI(message) {
            // Get current language from selector
            const languageSelector = document.getElementById('languageSelector');
            const currentLanguage = languageSelector ? languageSelector.value : 'en';
            
            // Use multilingual endpoint if language is not English
            if (currentLanguage !== 'en') {
                return await this.sendToAIMultilingual(message, currentLanguage);
            } else {
                return await this.sendToAIEnglish(message);
            }
        }
        
        async sendToAIMultilingual(message, language) {
            try {
                const response = await fetch('/chatbot/chat-multilingual/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': this.getCsrfToken()
                    },
                    body: JSON.stringify({
                        message: message,
                        conversation_history: this.conversationHistory,
                        user_context: this.userContext,
                        language: language
                    })
                });
                
                if (!response.ok) {
                    console.warn('Multilingual endpoint failed, falling back to English');
                    return await this.sendToAIEnglish(message);
                }
                
                const data = await response.json();
                
                // Update conversation history (store in English for consistency)
                this.conversationHistory.push(
                    { role: 'user', content: message },
                    { role: 'assistant', content: data.response }
                );
                
                // Keep only last 12 messages
                if (this.conversationHistory.length > 12) {
                    this.conversationHistory = this.conversationHistory.slice(-12);
                }
                
                return data.response;
            } catch (error) {
                console.error('Multilingual chat error:', error);
                return await this.sendToAIEnglish(message);
            }
        }
        
        async sendToAIEnglish(message) {
            const response = await fetch('/chatbot/chat/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': this.getCsrfToken()
                },
                body: JSON.stringify({
                    message: message,
                    conversation_history: this.conversationHistory,
                    user_context: this.userContext
                })
            });
            
            if (!response.ok) {
                throw new Error(`AI request failed: ${response.status}`);
            }
            
            const data = await response.json();
            
            // Update conversation history
            this.conversationHistory.push(
                { role: 'user', content: message },
                { role: 'assistant', content: data.response }
            );
            
            // Keep only last 12 messages
            if (this.conversationHistory.length > 12) {
                this.conversationHistory = this.conversationHistory.slice(-12);
            }
            
            return data.response;
        }
        
        async handleAction(action) {
            this.showChatInterface();
            
            let message = '';
            switch (action) {
                case 'cv-analysis':
                    message = "I want to analyze my CV for ATS optimization and improvements. What should I focus on?";
                    break;
                case 'internship-search':
                    message = "Find me relevant internship opportunities based on my skills and department.";
                    break;
                case 'skill-analysis':
                    message = "Analyze my current skills and suggest a learning path for career growth.";
                    break;
                case 'interview-prep':
                    message = "Help me prepare for technical and HR interviews for software roles.";
                    break;
                case 'career-guidance':
                    message = "Create a career roadmap for my current stage and future goals.";
                    break;
                case 'upload-cv':
                    this.triggerFileUpload();
                    return;
                case 'mock-interview':
                    message = "Let's start a mock interview session for a software developer role.";
                    break;
                default:
                    message = "How can you help me with my career development?";
            }
            
            this.addMessage(message, 'user');
            this.showTypingIndicator();
            
            try {
                const response = await this.sendToAI(message);
                this.removeTypingIndicator();
                this.addMessage(response, 'agent');
            } catch (error) {
                this.removeTypingIndicator();
                this.addMessage('Sorry, I encountered an error processing your request.', 'agent');
            }
        }
        
        async handleQuickAction(action) {
            let endpoint = '';
            let data = { user_context: this.userContext };
            
            switch (action) {
                case 'find-internships':
                    endpoint = '/chatbot/find-internships/';
                    break;
                case 'analyze-cv':
                    endpoint = '/chatbot/analyze-cv/';
                    break;
                case 'skill-gaps':
                    endpoint = '/chatbot/analyze-skills/';
                    break;
                case 'interview-prep':
                    endpoint = '/chatbot/interview-prep/';
                    data.message = 'interview preparation';
                    break;
                case 'career-roadmap':
                    endpoint = '/chatbot/career-guidance/';
                    break;
            }
            
            if (!endpoint) return;
            
            this.showChatInterface();
            this.showTypingIndicator();
            
            try {
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': this.getCsrfToken()
                    },
                    body: JSON.stringify(data)
                });
                
                this.removeTypingIndicator();
                
                if (response.ok) {
                    const result = await response.json();
                    this.addMessage(result.response, 'agent');
                } else {
                    this.addMessage('Unable to process request. Please try again.', 'agent');
                }
            } catch (error) {
                this.removeTypingIndicator();
                this.addMessage('Network error. Please check your connection.', 'agent');
            }
        }
        
        triggerFileUpload() {
            document.getElementById('cvUpload').click();
        }
        
        async handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Validate file type
            const validTypes = ['.pdf', '.doc', '.docx'];
            const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
            
            if (!validTypes.includes(fileExtension)) {
                alert('Please upload PDF, DOC, or DOCX files only.');
                return;
            }
            
            this.showChatInterface();
            this.addMessage(`Uploading CV: ${file.name}`, 'user');
            this.showTypingIndicator();
            
            const formData = new FormData();
            formData.append('cv_file', file);
            
            try {
                const response = await fetch('/chatbot/analyze-cv/', {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': this.getCsrfToken()
                    },
                    body: formData
                });
                
                this.removeTypingIndicator();
                
                if (response.ok) {
                    const result = await response.json();
                    this.addMessage(result.response, 'agent');
                } else {
                    this.addMessage('Error analyzing CV. Please try again.', 'agent');
                }
            } catch (error) {
                this.removeTypingIndicator();
                this.addMessage('Upload failed. Please try again.', 'agent');
            }
            
            // Reset file input
            event.target.value = '';
        }
        
        addMessage(content, type) {
            const chatMessages = document.getElementById('chatMessages');
            const messageId = `msg-${Date.now()}-${this.messageCounter++}`;
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}-message`;
            messageDiv.id = messageId;
            
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            
            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            
            if (type === 'agent') {
                avatar.innerHTML = '<i class="fas fa-robot"></i>';
                messageContent.innerHTML = this.formatMessage(content);
                
                // Add audio button for AI messages
                if (window.audioManager) {
                    const audioButton = window.audioManager.createAudioButton(content, messageId);
                    messageContent.innerHTML += audioButton;
                }
            } else {
                avatar.innerHTML = '<i class="fas fa-user"></i>';
                messageContent.textContent = content;
            }
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(messageContent);
            chatMessages.appendChild(messageDiv);
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        formatMessage(content) {
            // Convert markdown-like formatting to HTML
            return content
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/\n/g, '<br>')
                .replace(/### (.*?)(\n|$)/g, '<h3>$1</h3>')
                .replace(/## (.*?)(\n|$)/g, '<h4>$1</h4>')
                .replace(/# (.*?)(\n|$)/g, '<h5>$1</h5>')
                .replace(/‚Ä¢/g, '‚Ä¢')
                .replace(/(\d+\.)\s/g, '<br>$1 ')
                .replace(/‚úÖ/g, '‚úÖ')
                .replace(/‚ö†Ô∏è/g, '‚ö†Ô∏è')
                .replace(/üéØ/g, 'üéØ')
                .replace(/üíº/g, 'üíº')
                .replace(/üìÑ/g, 'üìÑ')
                .replace(/üé§/g, 'üé§')
                .replace(/üöÄ/g, 'üöÄ')
                .replace(/ü§ñ/g, 'ü§ñ')
                .replace(/üôè/g, 'üôè')
                .replace(/‚ú®/g, '‚ú®')
                .replace(/üåü/g, 'üåü')
                .replace(/üí°/g, 'üí°')
                .replace(/üìö/g, 'üìö')
                .replace(/üìÖ/g, 'üìÖ')
                .replace(/‚è∞/g, '‚è∞')
                .replace(/‚è±Ô∏è/g, '‚è±Ô∏è')
                .replace(/üéì/g, 'üéì');
        }
        
        showTypingIndicator() {
            const chatMessages = document.getElementById('chatMessages');
            
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message ai-message typing-indicator';
            typingDiv.id = 'typingIndicator';
            
            typingDiv.innerHTML = `
                <div class="message-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="message-content">
                    <div class="typing-dots">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
            `;
            
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        removeTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }
        
        showChatInterface() {
            document.getElementById('welcomeScreen').style.display = 'none';
            const chatInterface = document.getElementById('chatInterface');
            chatInterface.style.display = 'block';
            
            // Add welcome message if chat is empty
            if (document.getElementById('chatMessages').children.length === 0) {
                const hour = new Date().getHours();
                let greeting = "Hello";
                if (hour < 12) greeting = "Good morning";
                else if (hour < 17) greeting = "Good afternoon";
                else greeting = "Good evening";
                
                const name = this.userContext.username || 'there';
                this.addMessage(`${greeting}, ${name}! I'm CareerPal AI, your advanced career assistant. How can I help you today?`, 'agent');
            }
        }
        
        getCsrfToken() {
            const cookieValue = document.cookie
                .split('; ')
                .find(row => row.startsWith('csrftoken='))
                ?.split('=')[1];
            return cookieValue || '';
        }
    }
    
    // Initialize the AI Agent and Audio Manager
    document.addEventListener('DOMContentLoaded', function() {
        window.aiAgent = new EnhancedCareerPalAIAgent();
        window.audioManager = new AudioManager();
        
        // Load speech synthesis voices when available
        if ('speechSynthesis' in window) {
            speechSynthesis.onvoiceschanged = () => {
                console.log('Speech synthesis voices loaded');
            };
        }
    });
    </script>
</body>
</html>